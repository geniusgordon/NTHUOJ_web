<br>
{% if not is_new %}
<table id="testcase_table">
  <style>
    td {
      padding: 5px;
    }
    input {
      width: 150px;
    }
  </style>
  <tr>
    <th>Input</th>
    <th>Input</th>
    <th>Time Limit</th>
    <th>Memory Limit</th>
    <th></th>
  </tr>
  {% for t in testcase %}
  <tr data-target="{{t.pk}}">
    <td>
      <a href="/media/testcase/{{t.pk}}.in">{{t.pk}}.in</a>
    </td>
    <td>
      <a href="/media/testcase/{{t.pk}}.out">{{t.pk}}.out</a>
    </td>
    <td><input type="number" id="{{t.pk}}_time" name="time_limit" value="{{t.time_limit}}"></td>
    <td><input type="number" id="{{t.pk}}_memory" name="memory_limit" value="{{t.memory_limit}}"></td>
    <td><button class="btn btn-primary reupload_btn" onclick="return false"
        data-toggle="modal" data-target="#edit_testcase">ReUpload</button></td>
    <td><button class="btn btn-primary update_btn">Update</button></td>
    <td><button class="btn btn-danger delete_btn">Delete</button></td>
  </tr>
  {% endfor %}
  <tr>
    <form id="add_testcase" method="POST" 
      enctype="multipart/form-data" action="{% url 'problem:problem.views.testcase' pid %}">
      {% csrf_token %}
      <td><input type="file" name="t_in" required></td>
      <td><input type="file" name="t_out" required></td>
      <td><input type="number" id="new_time_limit" name="time_limit" required></td>
      <td><input type="number" id="new_memory_limit" name="memory_limit" required></td>
      <td><button class="btn btn-primary" id="add_testcase_btn">Add</button></td>
    </form>
  </tr>

</table>

<div class='modal fade' id='edit_testcase'>
  <div class='modal-dialog modal-sm'>
    <div class='modal-content'>
      <div class='modal-header'>
        <button type='button' class='close' data-dismiss='modal'>
          <span aria-hidden='true'>&times;</span>
          <span class='sr-only'>Close</span>
        </button>
        <h4 class='modal-title'>Edit Testcase</h4>
      </div>
      <form id="update_testcase" method="POST" 
        enctype="multipart/form-data" action="{% url 'problem:problem.views.testcase' pid %}">
        {% csrf_token %}
        <div class='modal-body'>
          <p>Input</p>
          <input type='file' name='t_in' required><br>
          <p>Output</p>
          <input type='file' name='t_out' required>
        </div>
        <div class='modal-footer'>
          <button class='btn btn-info'>Save changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
var update_tid = 0;
$(document).ready(function() {
    $("#add_testcase").submit(function (e) {
        e.preventDefault();
        add_new_testcase({{pid}}, new FormData(this));
    });
    $("#update_testcase").submit(function (e) {
        e.preventDefault();
        $.ajax({
          type: "POST",
          url: "/problem/{{pid}}/testcase/"+update_tid+"/",
          data: new FormData(this),  
          processData: false,
          contentType: false,
          success: function(data) {
            alert("update success");
          }
        });
    });
    $(".reupload_btn").click(function (e) {
        update_tid = $(this).parents("tr").attr('data-target');
    });
    $(".update_btn").click(function (e) {
        var tid = $(this).parents("tr").attr('data-target');
        var time = $("#"+tid+"_time").serialize();
        var memory = $("#"+tid+"_memory").serialize();
        var csrf = $("{% csrf_token %}").serialize();
        $.ajax({
            type: 'POST',
            url: '/problem/'+{{pid}}+'/testcase/'+tid+'/',
            data: time+"&"+memory+"&"+csrf,
            success: function(data) {
              alert('testcase updated')
            }
        });
        return false;
    });
    $(".delete_btn").click(function (e) {
        var tid = $(this).parents("tr").attr('data-target');
    });
});
</script>
{% else %}
<strong>Save your problem before uploading testcases</strong>
{% endif %}
